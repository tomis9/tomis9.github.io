<!DOCTYPE html>
<html lang="en">
<head>

  <title>tomis9&#39;s cookbook</title>
  <link rel="shortcut icon" type='image/x-icon' href="https://tomis9.github.io/favicon.ico"/>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  
  <link rel="stylesheet" href="https://tomis9.github.io/css/bootstrap-toc.css">

  
  <link rel="stylesheet" href="https://tomis9.github.io/css/darcula.css">

  
  <link rel="stylesheet" href="https://tomis9.github.io/css/style.css">

  
  <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">        
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono&display=swap" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Fascinate&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">

</head>


<body data-spy="scroll" data-target="#toc">



<nav id="navbar" class="navbar navbar-expand-md fixed-top navbar-hide transition">

  
  <a class="navbar-brand"></a>

  <button class="navbar-toggler float-xs-right" data-toggle="collapse" data-target="#collapsibleNavbar">
    Menu
  </button>

  <div class="collapse navbar-collapse" id="collapsibleNavbar">

    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://tomis9.github.io">Home</a>
      </li>
      
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Python</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/beautiful_soup/">beautiful soup</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/decorators/">decorators</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/sqlalchemy/">sqlAlchemy</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">R</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/cinr/">C in R</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rmariadb/">RMariaDB (former RMySQL)</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rcpp/">Rcpp</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/classess4/">classes - S4</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/data.table/">data.table</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/debugging/">debugging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/ggplot2/">ggplot2</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/lubridate/">lubridate</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/packages/">packages</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rtags/">rTags</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/reshape2/">reshape2</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rstanarm/">rstanarm</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/shiny/">shiny</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/sqldf/">sqldf</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tidyverse/">tidyverse</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Data engineering</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/hadoop/">hadoop</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/useful_processing/">useful processing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Machine learning</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/ml/">basic machine learning algorithms</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/validation/">model validation</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/useful_processing/">useful processing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">DevOps</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/docker/">docker</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/git/">git</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/heroku/">heroku</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/mesos/">mesos</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/vagrant/">vagrant</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Projects</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/vim_vs_emacs/">vim vs emacs - text mining to settle the editor war</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/cookbook/">writing a cookbook</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">scratchpad</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/hugo/">Hugo</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/file/">Rmarkdown total basics</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/caffee/">caffee</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/cassandra/">cassandra</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/featuretools/">featuretools</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/gitlab_ci/">gitlab-ci</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/kafka/">kafka</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/marathon/">marathon</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/nlp/">nlp</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/passing_arguments/">passing arguments to scripts</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/redis/">redis</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tensorflow_serving/">tensorflow_serving</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/theano/">theano</a>
          
        </div>
      </li>
    
    </ul>

  </div>  

</nav>



<div class="jumbotron text-center" id="header">

  <div id="header-title">
      <a href="https://tomis9.github.io">tomis9&#39;s cookbook</a>
  </div>

  <p style="color: white;">data science tutorials and snippets prepared by tomis9</p> 

</div>


<nav id="toc" data-toggle="toc" class="sticky-top d-none d-xl-block"></nav>

<div class="article">

<div class="article-categories">
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://tomis9.github.io/categories/r" role="button">R </a>
    &emsp;
  </br>
</div>
<div class="article-title">
  
  tidyverse

</div>
<div class="article-info">
    Dec 11, 2017 &emsp;  &emsp; 5 minutes read
</div>




<div id="what-is-tidyverse-and-why-would-you-use-it" class="section level2">
<h2>1. What is tidyverse and why would you use it?</h2>
<ul>
<li><p><a href="https://www.tidyverse.org/">tidyverse</a> is a collection of R packages that make working on data a much nicer experience than using base R;</p></li>
<li><p>it consists of tidyr, dplyr, ggplot2, tibble and a few more.</p></li>
</ul>
<p>To be honest, I prefer <a href="http://tomis9.com/data.table">data.table</a> to tidyverse, as it resembles basic R data.frames, is faster, more concise and, IMHO, more SQL-ish. But it takes longer to master and may be more difficult to understand, even your own code after some time. So, there is no obvious choice between data.table and dplyr.</p>
</div>
<div id="a-few-hello-world-examples" class="section level2">
<h2>2. A few “Hello World” examples</h2>
<div id="readr" class="section level3">
<h3>readr</h3>
<p>Or how do we read and write data in <code>tidyverse</code>.</p>
<p>Nobody uses basic R functions to read tabular data anymore. <code>data.table::fread()</code> and <code>readr::read_csv()</code> are smarter and faster.</p>
<p>Let’s create a sample dataset:</p>
<pre class="r"><code>sample_data &lt;- data.frame(
  col_a = letters[1:5],
  col_b = sample(1:100, 5)
)

class(sample_data)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>Then let’s write it and read back to R:</p>
<pre class="r"><code>readr::write_csv(x = sample_data, path = &#39;sample_data.csv&#39;)

data_t &lt;- readr::read_csv(file = &#39;sample_data.csv&#39;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   col_a = col_character(),
##   col_b = col_double()
## )</code></pre>
<p>As you can see, readr was happy to inform us that it imported column <code>col_a</code> as characters and column <code>col_b</code> as integers, which is exactly what we wanted. You can customise this behaviour. How to do it? <code>readr</code> has an extensive documentation ;).</p>
<p>The data we read is an object of class “tibble”, which has a nice printing method.</p>
<pre class="r"><code>class(data_t)</code></pre>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<pre class="r"><code>print(data_t)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   col_a col_b
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a        19
## 2 b        37
## 3 c        54
## 4 d        21
## 5 e        63</code></pre>
<p>Tibbles do not differ much from data.frames, except (according to the documentation, i.e. <code>?tibble::tibble</code>):</p>
<blockquote>
<pre><code>‘tibble()’ is a trimmed down version of ‘data.frame()’ that:

   • Never coerces inputs (i.e. strings stay as strings!).

   • Never adds ‘row.names’.

   • Never munges column names.

   • Only recycles length 1 inputs.

   • Evaluates its arguments lazily and in order.

   • Adds ‘tbl_df’ class to output.

   • Automatically adds column names.

‘data_frame()’ is an alias to ‘tibble()’.</code></pre>
</blockquote>
<p>Btw, to create a tibble by hand, you use:</p>
<pre class="r"><code>tibble::data_frame(a = 1:5, b = letters[1:5])</code></pre>
<pre><code>## Warning: `data_frame()` is deprecated, use `tibble()`.
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 5 x 2
##       a b    
##   &lt;int&gt; &lt;chr&gt;
## 1     1 a    
## 2     2 b    
## 3     3 c    
## 4     4 d    
## 5     5 e</code></pre>
<p>So it’s exactly the same as creating a usual <code>data.frame</code>.</p>
</div>
<div id="dplyr" class="section level3">
<h3>dplyr</h3>
<p>Or smart SQL (DDL + DML) in R.</p>
<p>Let’s have a look at the most common expressions:</p>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<p>As you can see, if you use function <code>filter()</code>, the one from dplyr package will be run.</p>
<pre class="r"><code>mtcars %&gt;% 
    select(mpg, cyl, disp) %&gt;% 
    filter(cyl == 8) %&gt;% 
    arrange(-disp) %&gt;%
    mutate(col_a = cyl * 2, col_b = &quot;hi&quot;) %&gt;%
    head()</code></pre>
<pre><code>##    mpg cyl disp col_a col_b
## 1 10.4   8  472    16    hi
## 2 10.4   8  460    16    hi
## 3 14.7   8  440    16    hi
## 4 19.2   8  400    16    hi
## 5 18.7   8  360    16    hi
## 6 14.3   8  360    16    hi</code></pre>
<p>What happened here:</p>
<ul>
<li><p>we used one of basic R datasets: mtcars;</p></li>
<li><p>we piped it with <code>%&gt;%</code> to the next function <em>(piping, or pipelines, is one of the oldest Unix concepts, dating back to 1970s)</em>;</p></li>
<li><p>we used a <code>select</code> to select columns we were interested in, just like in SQL;</p></li>
<li><p>we used a <code>filter</code> function just as SQL’s where clause;</p></li>
<li><p>we ordered the dataset with <code>arrange</code>;</p></li>
<li><p>we added two new columns with <code>mutate</code>;</p></li>
<li><p>we used a <code>head()</code> function to print only a few first rows of our dataframe.</p></li>
</ul>
<p>An example of grouping:</p>
<pre class="r"><code>mtcars %&gt;% 
    group_by(cyl) %&gt;% 
    summarise(count = n(), mean_hp = mean(hp))</code></pre>
<pre><code>## # A tibble: 3 x 3
##     cyl count mean_hp
##   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     4    11    82.6
## 2     6     7   122. 
## 3     8    14   209.</code></pre>
<p>What happened here:</p>
<ul>
<li><p>we aggregated our data with <code>group_by</code> in the same way as we do in SQL;</p></li>
<li><p>we wrote the aggregation functions: <code>n()</code> stands for number of objects or <code>count</code> in SQL and <code>mean()</code> is an example of an aggreagtion function (<code>sum</code>, <code>sd</code>, <code>median</code>, …)</p></li>
</ul>
<p>Another example of grouping, woth count (count is exactly the same as <code>group_by() %&gt;% summarise(n = n())</code>, but shorter):</p>
<pre class="r"><code>mtcars %&gt;% 
    count(cyl)</code></pre>
<pre><code>## # A tibble: 3 x 2
##     cyl     n
##   &lt;dbl&gt; &lt;int&gt;
## 1     4    11
## 2     6     7
## 3     8    14</code></pre>
</div>
<div id="ggplot2" class="section level3">
<h3>ggplot2</h3>
<p>I prepared a separate tutorial for <a href="http://tomis9.com/ggplot2">ggplot2</a>.</p>
</div>
</div>
<div id="curiosities" class="section level2">
<h2>3. Curiosities</h2>
<ul>
<li>you can pipe your data directly to ggplot2</li>
</ul>
<pre class="r"><code>library(dplyr)
library(ggplot2)

mtcars %&gt;% 
    filter(gear &gt;= 4) %&gt;% 
    ggplot(mapping = aes(x = mpg, y = cyl)) + 
    geom_point()</code></pre>
<p><img src="https://tomis9.github.io/tidyverse_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>But remember that in ggplot2 we use <code>+</code> for piping, not <code>%&gt;%</code>. There is an easy way to never forget about it: use data.table instead of dplyr ;).</p>
<ul>
<li>you can use <code>%&gt;%</code> operators on any class of data you like, e.g.:</li>
</ul>
<pre class="r"><code>data.table::as.data.table(mtcars) %&gt;% 
    filter(mpg &gt; 21) %&gt;% 
    select(mpg, cyl) %&gt;% 
    head()</code></pre>
<pre><code>##    mpg cyl
## 1 22.8   4
## 2 21.4   6
## 3 24.4   4
## 4 22.8   4
## 5 32.4   4
## 6 30.4   4</code></pre>
</div>
<div id="subjects-still-to-cover" class="section level2">
<h2>4. Subjects still to cover:</h2>
<ul>
<li><p>dplyr: joins, slice, spread, separate/unite (TODO) (spread is dcast)</p></li>
<li><p>table of contents</p></li>
</ul>
</div>

</div>

<div class="jumbotron text-center" id="footer">

  made using &emsp;
  <br class="d-xl-none">
  <a href="https://gohugo.io/">Hugo</a> |
  <a href="https://getbootstrap.com/">Bootstrap</a> |
  <a href="https://highlightjs.org/">highlightjs</a> |
  <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> |
  <a href="https://fonts.google.com/">Google fonts</a> &emsp;
  <br class="d-xl-none">
  <a href="https://github.com/tomis9/cookbook">github</a> |
  <a href="https://travis-ci.org/tomis9/cookbook">travis-ci</a> <a href="https://travis-ci.org/tomis9/cookbook"><img src="https://api.travis-ci.org/tomis9/cookbook.png"></img></a> |
  <a href="https://hub.docker.com/r/tomis9/cookbook">docker hub</a> &emsp;
  <br class="d-xl-none">
  <a href="https://aws.amazon.com/s3">Amazon S3</a> |
  <a href="https://aws.amazon.com/route53/">Amazon Route 53</a> &emsp;
  <br class="d-xl-none">
  Copyright &copy; 2019 tomis9

</div>

</body>



<script src="https://tomis9.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


<script src="https://tomis9.github.io/js/bootstrap-toc.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>


<script>
$(window).scroll(function() {
  
  if ($(window).scrollTop() > 100 ) {
    $('.navbar').removeClass('navbar-hide');
    $('.navbar').addClass('navbar-show');
  } else {
    $('.navbar').removeClass('navbar-show');
    $('.navbar').addClass('navbar-hide');
  };   	
});
</script>

</html>

