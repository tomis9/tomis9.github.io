<!DOCTYPE html>
<html lang="en">
<head>

  <title>tomis9&#39;s cookbook</title>
  <link rel="shortcut icon" type='image/x-icon' href="https://tomis9.github.io/favicon.ico"/>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  
  <link rel="stylesheet" href="https://tomis9.github.io/css/bootstrap-toc.css">

  
  <link rel="stylesheet" href="https://tomis9.github.io/css/darcula.css">

  
  <link rel="stylesheet" href="https://tomis9.github.io/css/style.css">

  
  <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">        
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono&display=swap" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Fascinate&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">

</head>


<body data-spy="scroll" data-target="#toc">



<nav id="navbar" class="navbar navbar-expand-md fixed-top navbar-hide transition">

  
  <a class="navbar-brand"></a>

  <button class="navbar-toggler float-xs-right" data-toggle="collapse" data-target="#collapsibleNavbar">
    Menu
  </button>

  <div class="collapse navbar-collapse" id="collapsibleNavbar">

    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://tomis9.github.io">Home</a>
      </li>
      
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Python</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/beautiful_soup/">beautiful soup</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/decorators/">decorators</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/sqlalchemy/">sqlAlchemy</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">R</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/cinr/">C in R</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rmariadb/">RMariaDB (former RMySQL)</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rcpp/">Rcpp</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/classess4/">classes - S4</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/data.table/">data.table</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/debugging/">debugging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/ggplot2/">ggplot2</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/lubridate/">lubridate</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/packages/">packages</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rtags/">rTags</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/reshape2/">reshape2</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rstanarm/">rstanarm</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/shiny/">shiny</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/sqldf/">sqldf</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tidyverse/">tidyverse</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Data engineering</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/hadoop/">hadoop</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/useful_processing/">useful processing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Machine learning</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/ml/">basic machine learning algorithms</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/validation/">model validation</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/useful_processing/">useful processing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">DevOps</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/docker/">docker</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/git/">git</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/heroku/">heroku</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/mesos/">mesos</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/vagrant/">vagrant</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Projects</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/vim_vs_emacs/">vim vs emacs - text mining to settle the editor war</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/cookbook/">writing a cookbook</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">scratchpad</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://tomis9.github.io/hugo/">Hugo</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/file/">Rmarkdown total basics</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/caffee/">caffee</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/cassandra/">cassandra</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/featuretools/">featuretools</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/gitlab_ci/">gitlab-ci</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/kafka/">kafka</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/marathon/">marathon</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/nlp/">nlp</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/passing_arguments/">passing arguments to scripts</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/redis/">redis</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/tensorflow_serving/">tensorflow_serving</a>
          
            <a class="dropdown-item" href="https://tomis9.github.io/theano/">theano</a>
          
        </div>
      </li>
    
    </ul>

  </div>  

</nav>



<div class="jumbotron text-center" id="header">

  <div id="header-title">
      <a href="https://tomis9.github.io">tomis9&#39;s cookbook</a>
  </div>

  <p style="color: white;">data science tutorials and snippets prepared by tomis9</p> 

</div>


<nav id="toc" data-toggle="toc" class="sticky-top d-none d-xl-block"></nav>

<div class="article">

<div class="article-categories">
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://tomis9.github.io/categories/devops" role="button">DevOps </a>
    &emsp;
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://tomis9.github.io/categories/data-engineering" role="button">Data engineering </a>
    &emsp;
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://tomis9.github.io/categories/r" role="button">R </a>
    &emsp;
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://tomis9.github.io/categories/python" role="button">Python </a>
    &emsp;
  </br>
</div>
<div class="article-title">
  
  testing

</div>
<div class="article-info">
    Feb 4, 2018 &emsp;  &emsp; 5 minutes read
</div>



<h2 id="1-what-is-testing-and-why-would-you-use-it">1. What is testing and why would you use it?</h2>

<ul>
<li><p>testing or <a href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a> (TDD) is a discipline, which relies on writing a test for every functionality <em>before</em> creating it;</p></li>

<li><p>at first the test will fail, as we have not provided the proper functionality yet. Our goal is to fulfill this functionality, so the test will pass.</p></li>
</ul>

<p>In reality you modify your tests as you create the functionality or even write the tests after you are finished writing it. It&rsquo;s OK as long as you remember to cover all the functions with tests.</p>

<h2 id="2-hello-world-examples">2. &ldquo;Hello World&rdquo; examples</h2>

<h3 id="r-testthat">R (testthat)</h3>

<p>Let&rsquo;s go through testing two simple functions:</p>

<pre><code>library(testthat)

context(&quot;simple example tests&quot;)

divider &lt;- function(a, b) {
  if (b == 0) {
    warning(&quot;One does not simply divide by zero.&quot;)
    return(NULL)
  }
  x &lt;- a / b
  return(x)
}

test_that(
  desc = &quot;check proper division by `divider()`&quot;,
  code = {
    expect_equal(divider(10, 5), 2)

    expect_warning(divider(2, 0))

    expect_null(suppressWarnings(divider(10, 0)))
  }
)

summer &lt;- function(a, b) {
  x &lt;- a + b
  if (x == 5) x &lt;- x + 1  ## a strange bug
  return(x)
}

test_that(
  desc = &quot;check proper summing by `summer`&quot;,
  code = {
    expect_equal(summer(2, 2), 4, info = &quot;two and two is four&quot;)
    expect_equal(summer(2, 3), 5, info = &quot;two and three is five&quot;)
  }
)
</code></pre>

<p>What have we done here?</p>

<ul>
<li><p>we loaded <code>testthat</code> package;</p></li>

<li><p>we provided a context - this is the first message that appears in tests summary and serves as a title for this particular group of tests;</p></li>
</ul>

<p>*Couriously, in order to run test properly, you <em>have to</em> provide context <a href="https://stackoverflow.com/questions/50083521/error-in-xmethod-attempt-to-apply-non-function-in-testthat-test-when">link</a>*.</p>

<ul>
<li><p>we wrote a function <code>divider</code>, which divides two numbers and <code>summer</code>, which adds twwo numbers (clever!); as you can see, there is a strange bug in <code>summer</code></p></li>

<li><p><code>test_that</code> functions belong to <code>testthat</code> package and they will check if these functions run properly;</p></li>

<li><p>there are various types of <code>expect_...</code>, a pretty interesting one is <code>expect_fail(expect_...())</code>;</p></li>

<li><p>you should provide additional description (<code>desc</code>) to each <code>test_that</code> function, so you could easily find which test failed; you can also provide info for every single <code>expect_...</code>.</p></li>
</ul>

<p>Now we can run our tests with <code>testthat::test_file(&lt;name_of_file&gt;)</code> or <code>testthat::test_dir('tests')</code>, depending on where you store your functions with tests. In production, you obviously keep testing functions in separate files, preferably in a <code>tests</code> folder and each file is called <code>test_...</code>.  In that case you source all the functions you want to test simply with <code>source()</code>.</p>

<p>Testing our above file will result in:</p>

<pre><code>R&gt; test_file('test.R')                                                          
✔ | OK F W S | Context
✖ |  4 1     | simple example tests
────────────────────────────────────────────────────────────────────────────────
test.R:37: failure: check proper summing by `summer`
summer(2, 3) not equal to 5.
1/1 mismatches
[1] 6 - 5 == 1
two and three is five
────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════
OK:       4
Failed:   1
Warnings: 0
Skipped:  0
</code></pre>

<p>Information, that 4 tests have passed, one has failed. The one that failes was in 37th line of the test file, when we were &lsquo;checking proper summing by summer&rsquo;. According to <code>summer</code> two and three is not five.</p>

<h3 id="python-pytest">Python (pytest)</h3>

<p>When testing Python code, I usually use <code>pytest</code>, however <code>unittest</code> still seems seems to be standard among the community, quite surprisingly. The main advantage of <code>pytest</code> comparing to <code>unittest</code> is it&rsquo;s simplicity: it may take even less than a minute to start being productiove with testing.</p>

<p>Let&rsquo;s create a very simple function and save it to a file:</p>

<p>func.py</p>

<pre><code>def divider(a, b):
    return a / b
</code></pre>

<p>and a functioh which will test it&rsquo;s validity:</p>

<p>test_divider.py</p>

<pre><code>from func import divider


def test_divider():
    assert divider(10, 2) == 5
</code></pre>

<p><em>A testing file&rsquo;s name should begin with <code>test_</code>, so pytest would recognize it. If you create many of these files, you can keep them in one file called <code>tests</code>.</em></p>

<p>Now run <code>pytest</code> command from console and you will see</p>

<pre><code>$ pytest
================================ test session starts ================================
platform linux -- Python 3.5.2, pytest-3.7.2, py-1.5.4, pluggy-0.7.1
rootdir: /home/tomek/cookbook/scratchpad/testing, inifile:
plugins: pylama-7.4.1
collected 1 item                                                                    

test_divider.py .                                                             [100%]

============================= 1 passed in 0.01 seconds ==============================
</code></pre>

<p>that the test passed. If you want to receive more specific information, use the verbose flag: <code>pytest -v</code>.</p>

<p>What happens if the test failes? Let&rsquo;s write another test, which will clearly cause an error:</p>

<p>test_divider.py</p>

<pre><code>from func import divider


def test_divider():
    assert divider(10, 2) == 5

def test_divider_by_zero:
    assert divider(10, 0)
</code></pre>

<p>Running pytest causes:</p>

<pre><code>$ pytest
=================================== test session starts ===================================
platform linux -- Python 3.5.2, pytest-3.7.2, py-1.5.4, pluggy-0.7.1
rootdir: /home/tomek/cookbook/scratchpad/testing, inifile:
plugins: pylama-7.4.1
collected 2 items                                                                         

test_divider.py .F                                                                  [100%]

======================================== FAILURES =========================================
__________________________________ test_divider_by_zero ___________________________________

    def test_divider_by_zero():
&gt;       assert divider(5, 0)

test_divider.py:9: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

a = 5, b = 0

    def divider(a, b):
&gt;       return a / b
E       ZeroDivisionError: division by zero

func.py:2: ZeroDivisionError
=========================== 1 failed, 1 passed in 0.02 seconds ============================
</code></pre>

<p>As we can see, dividing by zero raises a ZeroDivisionError.</p>

<h2 id="3-useful-links">3. Useful links</h2>

<ul>
<li><p>R:</p>

<ul>
<li><p><a href="https://journal.r-project.org/archive/2011/RJ-2011-002/RJ-2011-002.pdf">Hadley Wichkam&rsquo;s article on testthat</a></p></li>

<li><p><a href="https://github.com/r-lib/usethis">usethis</a> - useful if you want to test a package</p></li>
</ul></li>

<li><p>Python:</p>

<ul>
<li><p><a href="https://learning.oreilly.com/library/view/test-driven-development-with/9781449365141/">Test driven development with Python</a></p></li>

<li><p><a href="https://docs.python-guide.org/writing/tests/">Probably the best book with snippets and &ldquo;Hello World&rdquo; examples: The Hitchhiker&rsquo;s Guide to Python</a></p></li>
</ul></li>
</ul>

<h2 id="4-subjects-still-to-cover">4. Subjects still to cover</h2>

<ul>
<li>unittest, coverage (TODO)</li>
</ul>

</div>

<div class="jumbotron text-center" id="footer">

  made using &emsp;
  <br class="d-xl-none">
  <a href="https://gohugo.io/">Hugo</a> |
  <a href="https://getbootstrap.com/">Bootstrap</a> |
  <a href="https://highlightjs.org/">highlightjs</a> |
  <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> |
  <a href="https://fonts.google.com/">Google fonts</a> &emsp;
  <br class="d-xl-none">
  <a href="https://github.com/tomis9/cookbook">github</a> |
  <a href="https://travis-ci.org/tomis9/cookbook">travis-ci</a> <a href="https://travis-ci.org/tomis9/cookbook"><img src="https://api.travis-ci.org/tomis9/cookbook.png"></img></a> |
  <a href="https://hub.docker.com/r/tomis9/cookbook">docker hub</a> &emsp;
  <br class="d-xl-none">
  <a href="https://aws.amazon.com/s3">Amazon S3</a> |
  <a href="https://aws.amazon.com/route53/">Amazon Route 53</a> &emsp;
  <br class="d-xl-none">
  Copyright &copy; 2019 tomis9

</div>

</body>



<script src="https://tomis9.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


<script src="https://tomis9.github.io/js/bootstrap-toc.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>


<script>
$(window).scroll(function() {
  
  if ($(window).scrollTop() > 100 ) {
    $('.navbar').removeClass('navbar-hide');
    $('.navbar').addClass('navbar-show');
  } else {
    $('.navbar').removeClass('navbar-show');
    $('.navbar').addClass('navbar-hide');
  };   	
});
</script>

</html>

